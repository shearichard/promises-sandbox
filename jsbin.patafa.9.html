<!DOCTYPE html>
<!--
Created using JS Bin
http://jsbin.com

Copyright (c) 2016 by rshea (http://jsbin.com/patafa/9/edit)

Released under the MIT license: http://jsbin.mit-license.org
-->
<meta name="robots" content="noindex">
<html>
<head>
<script src="https://cdn.jsdelivr.net/momentjs/2.10.6/moment-with-locales.min.js"></script>
<meta name="description" content="Promises Sandbox">
<script src="https://code.jquery.com/jquery-2.2.4.js"></script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>Promises Sandbox</title>
    

    <style>
      body {
      padding-top: 80px;
      text-align: center;
      font-family: monaco, monospace;
      background: #ff5d00;
    }
    h1, h2 {
      display: inline-block;
    }
    h1 {
      font-size: 30px
    }
    h2 {
      font-size: 20px;
    }
    span {
      background: #fd0;
    }
    #output{
        background: #ccb100;
        width: 50%;
        margin: auto;
        border-width: 3px;
        border-color: #a2ff00;
        border-style: solid;
    }
    #logout{
        padding-top: 0.5em;
    }   
    </style>
</head>
<body>
    <h1>Test of jQuery .when</h1>
    <p>This is primarily a test of the jQuery .when facility</p>
    <p>Look at console messages for output of this test as well as the area below.</p>
    <div id='output'></div>
<script id="jsbin-javascript">
function logit(s){
    console.log(s);
    $('#output').append('<div class=logout><pre>' + s + '</pre></div>');
}
var p0 = new Promise(function(resolve,reject){
    setTimeout(function(){
        resolve("Yay! This is p0");
    },20);
});
var p1 = new Promise(function(resolve,reject){
    setTimeout(function(){
        resolve("Yay! This is p1");
    },19);
});
var p00 = new Promise(function(resolve,reject){
    setTimeout(function(){
        resolve("Yay! This is p00");
    },200);
});
var p10 = new Promise(function(resolve,reject){
    setTimeout(function(){
        resolve("Yay! This is p10");
    },1);
});

console.log("A");
logit("A");
p0.then(function(msg){
    logit(msg); // Yay!
});
p1.then(function(msg){
    logit(msg); // Yay!
});
logit("B");
//var fetch0 = function() { return {$.ajax('https://httpbin.org/get?A=B,C,D')}};
var fetch1 = function() 
{ 
  return function(){
    $.ajax('https://httpbin.org/get?Z=Y,X,W');  
  };
};
var fetch11 = function() 
{ 
  $.ajax('https://httpbin.org/get?Z=Y,X,W');  
};
//var fetch1 = { return {$.ajax}}
var goodFetches = function (v1, v2){
  logit("GOOD : All out of when's");
  logit(v1[0].args.A);
  //logit(v1[1]);
  //logit(v1[2].statusText);
  //logit(v1[2].responseJSON.args.A);
  logit(v2[0].args.Z);
  logit(v2);  
};
var badFetches = function(v1, v2){
  logit("BAD : All out of when's");
  logit(v1.responseText);
  logit(v2.responseText);
};
//$.when( fetch11, $.ajax('https://httpbin.org/get?Z=Y,X,W'))
//  .then(goodFetches, badFetches);
logit("C");
logit("1++++++++++++++++++++++++++++++++++++++++++++++++++++++");
var count = 0;

function onSuccess () {
    count++;
}

function callback (data) {
    logit('Call back : ' + data);
}
    
function showData() {
    logit('showData : ' + count);
}

function method1() {
    return $.ajax('http://jsfiddle.net/echo/jsonp/', {
        dataType: 'jsonp',
        //jsonp: '$callback',
        success: onSuccess
    });
}

function method2() {
    return $.ajax('http://jsfiddle.net/echo/jsonp/', {
        dataType: 'jsonp',
        //jsonp: '$callback',
        success: onSuccess
    });
}

$.when(method1(), method2()).then(showData);
logit("2++++++++++++++++++++++++++++++++++++++++++++++++++++++");


</script>
</body>
</html>
